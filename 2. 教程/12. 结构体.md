![avatar](../_images/HelpTutorial.png)

# 教程12：结构体

欢迎回来！做好准备，这一节我们会看一些比较高级的内容。

本节将会覆盖**结构体**相关的内容。什么是**结构体**，我们如何在程序中使用以及一些例子。

**结构体**是非常有用的，他们能让程序更加可读。

## 什么是结构体？

一个**结构体**更像是一个**数组**，可以用来保存一些信息。

一个数组通过一个数字索引来访问数据，而一个**结构体**使用一个名字。

在一个横向卷轴游戏中，我们可以用一个**结构体**来保存玩家的所有信息。游戏人物会有在屏幕上的位置、生命值、速度、攻击力和防御力等。所有这些数据能够保存在一个**结构体**中，那么这样，这些信息就会更容易访问。

让我们后退一步并且创建一个非常简单的**结构体**，来存储一些关于人的信息，拷贝下面的代码到编辑器中，当然，可以随便修改一些信息。

```
  1. person = [
  2.     .name = "Luke",
  3.     .likes = "Chocolate",
  4.     .dislikes = "Vegetables",
  5.     .skills = "Coding"
  6. ]
```

好了，这段代码就设定了一个我们可以使用的**结构体**。我们可以使用诸如```print(person.name)```或者```print(person.dislikes)```。非常简单。

## 格式化

让我们快速看一下这个代码中奇怪的地方。如果对一个刚开始写代码的人来说，这看起来非常奇怪。

最重要的是方括号和逗号。首先，我们命名了一个**结构体**，名字是```person```。我们用一个方括号开始了**结构体**的定义。定义了一些可能需要的属性。这些属性必须用逗号隔开。最后我们在用一个方括号结束**结构体**的定义。

记住，这不是唯一的来格式化**结构体**的方法。你也可以用下面的方式来定义：

```
  1. person = [.name = "Luke",
  2.           .likes = "Chocolate",
  3.           .dislikes = "Vegetables",
  4.           .skills = "Coding"]
```

效果是一样的，还可以是下面这样：

```
  1. person = [.name = "Luke", .likes = "Chocolate", .dislikes = "Vegetables", .skills = "Coding"]
```

之前提到过，最重要的部分是方括号和逗号。如何组织代码，拒绝与你自己。

## 创建一个结构体的数组

上面的例子很简单，不过如果我们想保存多个人的信息呢？

我们可以使用结构体的数组，就是一个简单的数组，但是每一个元素是一个**结构体**。看一下下面的代码：

```
  1. people = [
  2.     [    
  3.         .name = "Luke",
  4.         .likes = "Chocolate",
  5.         .dislikes = "Vegetables",
  6.         .skills = "Coding"
  7.     ],
  8.     [
  9.         .name = "Colin",
 10.         .likes = "Trains",
 11.         .dislikes = "Brussels Sprouts",
 12.         .skills = "Dancing"
 13.     ]
 14. ]
```

现在就开始有一些复杂了，请不要被那么多方括号吓到。

在第一行我们不在定义一个叫```person```的**结构体**，而是创建了一个叫```people```的数组，有两个元素。每一个元素都是一个**结构体**，就和之前单独的**结构体**一样。

第一个结构体保存在```people[0]```，第二个保存在```people[1]```。

假如我们向打印Colin的喜好（likes），我们可以通过代码```print(people[1].likes)```来达到目的。再比如我们想打印Luke的名字，我们可以用```print(people[0].name)```来完成。

使用一个结构体的数组，我们可以方便快捷地在程序中保存信息。通过**结构体**，**数组**和**for循环**的组合，你可以实现一些非常棒的事情。

## 在一个简单的游戏中使用结构体

在本教程的主要部分，我们会使用一个**结构体**的**数组**来制作一个简单的竞速游戏，有三个图形会穿过屏幕，我们可以猜猜谁会赢！

我们会使用三个图形，一个三角形，一个圆形还有一个五边形。每一个图形都需要一个名字，一对**x**和**y**坐标，一个表示边数的数字，一个颜色还有一个穿过屏幕的速度。

我们的速度会是50以内的随即值。这样的话，每一次运行游戏，我们都会得到不同的结果。

让我们先构建**结构体**，这会有很多代码，所以建议直接将下面的代码拷贝到**编辑器**中。

```
  1. shapes = [
  2.     [
  3.         .name  = "Triangle",
  4.         .x     = 0,
  5.         .y     = gheight() / 2 - gheight() / 3,
  6.         .sides = 3,
  7.         .col   = red,
  8.         .speed = random( 50 )
  9.     ],
 10.     [
 11.         .name  = "Circle",
 12.         .x     = 0,
 13.         .y     = gheight() / 2,
 14.         .sides = 32,
 15.         .col   = green,
 16.         .speed = random( 50 )
 17.     ],
 18.     [
 19.         .name  = "Pentagon",
 20.         .x     = 0,
 21.         .y     = gheight() / 2 + gheight() / 3,
 22.         .sides = 5,
 23.         .col   = blue,
 24.         .speed = random( 50 )
 25.     ]
 26. ]
```

看一下这个**结构体**的**数组**，我们创建了一个**数组**叫```shapes```，有三个元素。每一个元素都是一个拥有6个**属性**的**结构体**。

就像之前people的例子一样，我们可以用```print(shapes[1].name)```这样的代码来访问数据。

接下来，添加使用这些数据的代码，我们需要一个循环来让图形动起来，并且需要一个**for循环**来遍历我们的图形数组。

```
 28. loop
 29.     clear()
 30.     for i = 0 to len( shapes ) loop
 31.         circle( shapes[i].x, shapes[i].y, 100, shapes[i].sides, shapes[i].col, false )
 32.     repeat
 33.     update()
 34. repeat
```

这是一个**结构体****数组**非常有用的一个场景。30到32行的**for循环**重复了3次，我们创建了一个**变量**```i```来作为索引来访问这西图形，并且我们在每个图形**x**和**y**的位置围绕图形画一个圆形。因为```circle()```函数的工作机制，我们可以通过给定边数来得到不同的图形。这就是我们会把边数作为一个属性存放在**结构体**中。

当**for循环**结束的时候，我们```update()```一下屏幕，并且重复这个**循环**。

现在让我们让这些图形动起来。

将代码改为下面的样子

```
 28. loop
 29.     clear()
 30.     for i = 0 to len( shapes ) loop
 31.         shapes[i].x += shapes[i].speed
 32.         circle( shapes[i].x, shapes[i].y, 100, shapes[i].sides, shapes[i].col, false )
 33.     repeat
 34.     update()
 35. repeat
```

第31行，我们用图形的速度来增加**x**的位置。运行程序，可以看到不同的图形以不同的速度移动。

那么现在剩下的工作就是在比赛结束后添加一个胜利界面。

现在是一个恰当的时间点来创建我们自己的**函数**。我们可以传递获胜的图形的名称和颜色到函数中，并且在胜利界面使用这些信息。更新代码如下。在35行```repeat```下面。

```
 37. function victoryScreen( name, col )
 38.     text = name + " Wins!"
 39.     tsize = 100
 40.     textSize( tSize )
 41.     loop
 42.         clear()
 43.         drawText( gwidth() / 2 - textWidth( text ) / 2, gheight() / 2, tSize, col, text )
 44.         update()
 45.     repeat
 46. return void
```

这里我们有一个**用户自定义函数**，这部分代码会在调用的时候运行。

这个**函数**的目的是在屏幕中心打印出赢得比赛的图形的名字，并且有正确的颜色。为此，我们需要两条信息，他们是图形的名称和形状。

在第一行，我们给**函数**起的名字为```victoryScreen()```并且接受两个**参数**。第一个参数用用```name```保存，第二个用```col```保存。接下来我们就能在**函数**中使用这些变量了。

首先定义一个叫```text```的**变量**，来保存要在屏幕上显示的文本。我们把```name```和"Wins!"添加到变量中。要在屏幕上显示文本，```text```**变量**非常重要。

接下来我们定义一个```size```**变量**来保存文本的长度。这样做可以让我们能够找到刚好的打印位置。函数

第40行，我们用```textSize()```**函数**，将文本的长度保存到```tSize```**变量**中。

现在移动到主要的**循环**部分，我们需要一个**循环**，因为我们希望文本一直显示直到程序结束。当然我们需要一个```clear()```和```update()```方法，因为我们要在屏幕上显示一些内容。

在我们的**循环**中，最主要的指令是```drawText()```**函数**，用来显示文本到屏幕上，并且与```print()```相比能提供更多的控制。我们可以在像素级别定位文本，甚至设定颜色。

可以看到，```drawText()```中的**x**变量有点奇怪：

```
 43.        drawText( gwidth() / 2 - textWidth( text ) / 2 
```

我们希望文本被显示在屏幕的正中心，无论文本有多长。如果我们用固定的坐标来显示文本，在TV模式下或者手持模式中会有很不同的显示效果。如果获胜的图形不同的话，也会有不一样的显示效果，因为图形的名字长度不同。

因为这样的原因，我们必须根据文本的长度来调整位置.

我们用```textWidth()```**函数**可以确定文本的像素宽度。我们可以除以二得到一般的长度。如果我们用屏幕中间的位置减去这个长素，就能得到具体的位置位置，刚好将文本放到屏幕中间。

看起来很麻烦，不过这是定位文本很有用的技术，掌握这个技术，可以用在其他项目里面。

好了，**自定义函数**部分已经结束了。在**函数**的末尾有一句```return void```，因为我们不需要返回任何东西。

现在剩下的部分就是在**循环**中调用**函数**。

调整主**循环**的代码成下面的样子，我们只需要加一个**if语句**来判断图形是否到达了终点。

```
 28. loop
 29.     clear()
 30.     for i = 0 to len( shapes ) loop
 31.         shapes[i].x += shapes[i].speed
 32.         if shapes[i].x > gwidth() then
 33.             victoryScreen( shapes[i].name, shapes[i].col )
 34.         endif
 35.         circle( shapes[i].x, shapes[i].y, 100, shapes[i].sides, shapes[i].col, false )
 36.     repeat
 37.     update()
 38. repeat
```

第32到34行包含我们的**if语句**，用来在**for循环**中检查当前图形是否到达了屏幕边缘。如果到达了重点，我们调用```victoryScreen()```**函数**，平将当前图形的名字和颜色作为参数。

这样就完成了，或许你能添加更多的图形到比赛中？因为我们游戏的主流程已经确定，如果要添加图形，只需要在**数组**中添加就行了。

## 复习

一个**结构体**是用来保存数据。和**数组**非常相似，除了在**结构体**中的数据都有一个名字，而**数组**中有一个索引标号。你可以自由地组合这些技术来使用。你可以在**结构体**中保存**数组**，也可以在**数组**中保存多个**结构体**。

你可以自己尝试一下来弄清楚他们是如何工作的。

我们下次再见。

#### 用到的函数和关键字

```else```,```endif```,```circle()```,```clear()```,```drawText()```,```for```,```if```,```loop```,```repeat```,```textSize()```,```then```,```update()```